<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>S (paf.Paf_mirage.S)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">paf</a> &#x00BB; <a href="../index.html">Paf_mirage</a> &#x00BB; S</nav><h1>Module type <code>Paf_mirage.S</code></h1></header><dl><dt class="spec type" id="type-stack"><a href="#type-stack" class="anchor"></a><code><span class="keyword">type</span> stack</code></dt><dd><p>The type of the TCP/IP stack.</p></dd></dl><div class="spec module" id="module-TCP"><a href="#module-TCP" class="anchor"></a><code><span class="keyword">module</span> <a href="TCP/index.html">TCP</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><div class="spec module" id="module-TLS"><a href="#module-TLS" class="anchor"></a><code><span class="keyword">module</span> <a href="TLS/index.html">TLS</a> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type of the <i>socket</i> bound on a specific port (via <a href="index.html#val-init"><code>init</code></a>).</p></dd></dl><dl><dt class="spec type" id="type-dst"><a href="#type-dst" class="anchor"></a><code><span class="keyword">type</span> dst</code><code> = Ipaddr.t * int</code></dt></dl><dl><dt class="spec value" id="val-init"><a href="#val-init" class="anchor"></a><code><span class="keyword">val</span> init : <span>port:int</span> <span>&#45;&gt;</span> <a href="index.html#type-stack">stack</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p><code>init ~port stack</code> bounds the given <code>stack</code> to a specific port and return the main socket <a href="index.html#type-t"><code>t</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-accept"><a href="#val-accept" class="anchor"></a><code><span class="keyword">val</span> accept : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span><span>(<a href="index.html#module-TCP">TCP</a>.flow, <span>[&gt; `Closed ]</span>)</span> Stdlib.result</span> Lwt.t</span></code></dt><dd><p><code>accept t</code> waits an incoming connection and return a <i>socket</i> connected to a peer.</p></dd></dl><dl><dt class="spec value" id="val-close"><a href="#val-close" class="anchor"></a><code><span class="keyword">val</span> close : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>close t</code> closes the main <em>socket</em>.</p></dd></dl><dl><dt class="spec value" id="val-http_service"><a href="#val-http_service" class="anchor"></a><code><span class="keyword">val</span> http_service : <span>?&#8288;config:Httpaf.Config.t</span> <span>&#45;&gt;</span> <span>error_handler:<span>(<a href="index.html#type-dst">dst</a> <span>&#45;&gt;</span> Httpaf.Server_connection.error_handler)</span></span> <span>&#45;&gt;</span> <span>(<a href="index.html#type-dst">dst</a> <span>&#45;&gt;</span> Httpaf.Server_connection.request_handler)</span> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../Paf/index.html#type-service">Paf.service</a></span></code></dt><dd><p><code>http_service ~error_handler request_handler</code> makes an HTTP/AF service where any HTTP/1.1 requests are handled by <code>request_handler</code>. The returned service is not yet launched (see <a href="index.html#val-serve"><code>serve</code></a>).</p></dd></dl><dl><dt class="spec value" id="val-https_service"><a href="#val-https_service" class="anchor"></a><code><span class="keyword">val</span> https_service : <span>tls:Tls.Config.server</span> <span>&#45;&gt;</span> <span>?&#8288;config:Httpaf.Config.t</span> <span>&#45;&gt;</span> <span>error_handler:<span>(<a href="index.html#type-dst">dst</a> <span>&#45;&gt;</span> Httpaf.Server_connection.error_handler)</span></span> <span>&#45;&gt;</span> <span>(<a href="index.html#type-dst">dst</a> <span>&#45;&gt;</span> Httpaf.Server_connection.request_handler)</span> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> <a href="../../Paf/index.html#type-service">Paf.service</a></span></code></dt><dd><p><code>https_service ~tls ~error_handler request_handler</code> makes an HTTP/AF service over TLS (from the given TLS configuration). Then, HTTP/1.1 requests are handled by <code>request_handler</code>. The returned service is not yet launched (see <a href="index.html#val-serve"><code>serve</code></a>).</p></dd></dl><dl><dt class="spec value" id="val-serve"><a href="#val-serve" class="anchor"></a><code><span class="keyword">val</span> serve : <span>?&#8288;stop:Lwt_switch.t</span> <span>&#45;&gt;</span> <span><span class="type-var">'t</span> <a href="../../Paf/index.html#type-service">Paf.service</a></span> <span>&#45;&gt;</span> <span class="type-var">'t</span> <span>&#45;&gt;</span> <span>[ <span>`Initialized of <span>unit Lwt.t</span></span> ]</span></code></dt><dd><p><code>serve ?stop service</code> returns an initialized promise of the given service <code>service</code>. <code>stop</code> can be used to stop the service.</p></dd></dl><dl><dt class="spec value" id="val-tcp_protocol"><a href="#val-tcp_protocol" class="anchor"></a><code><span class="keyword">val</span> tcp_protocol : <span><span>(<a href="index.html#type-stack">stack</a> * Ipaddr.t * int, <a href="index.html#module-TCP">TCP</a>.flow)</span> Mimic.protocol</span></code></dt><dt class="spec value" id="val-tcp_edn"><a href="#val-tcp_edn" class="anchor"></a><code><span class="keyword">val</span> tcp_edn : <span><span>(<a href="index.html#type-stack">stack</a> * Ipaddr.t * int)</span> Mimic.value</span></code></dt><dt class="spec value" id="val-tls_edn"><a href="#val-tls_edn" class="anchor"></a><code><span class="keyword">val</span> tls_edn : <span><span>(<span><span><span>[ `host ]</span> Domain_name.t</span> option</span> * Tls.Config.client * <a href="index.html#type-stack">stack</a> * Ipaddr.t * int)</span> Mimic.value</span></code></dt><dt class="spec value" id="val-tls_protocol"><a href="#val-tls_protocol" class="anchor"></a><code><span class="keyword">val</span> tls_protocol : <span><span>(<span><span><span>[ `host ]</span> Domain_name.t</span> option</span> * Tls.Config.client * <a href="index.html#type-stack">stack</a> * Ipaddr.t * int, <a href="TLS/index.html#type-flow">TLS.flow</a>)</span> Mimic.protocol</span></code></dt><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : <span>ctx:Mimic.ctx</span> <span>&#45;&gt;</span> <span>error_handler:<span>(<span><a href="index.html#type-dst">dst</a> option</span> <span>&#45;&gt;</span> <a href="../../Alpn/index.html#type-client_error">Alpn.client_error</a> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>response_handler:<span>(<span><a href="index.html#type-dst">dst</a> option</span> <span>&#45;&gt;</span> <span><span>[ `read ]</span> <a href="../../Alpn/index.html#type-resp_handler">Alpn.resp_handler</a></span> <span>&#45;&gt;</span> unit)</span></span> <span>&#45;&gt;</span> <span>[ <span>`V1 of Httpaf.Request.t</span> <span><span>| `V2</span> of H2.Request.t</span> ]</span> <span>&#45;&gt;</span> <span><span><span>(<span><span>[ `write ]</span> <a href="../../Alpn/index.html#type-body">Alpn.body</a></span>, <span>[&gt; Mimic.error ]</span>)</span> Stdlib.result</span> Lwt.t</span></code></dt></dl></div></body></html>